<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Service - Noobly JS Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui.css">
    <link rel="stylesheet" href="/services/css/navigation.css">
    <style>
        /* Custom CSS for professional look */
        :root {
            --custom-primary: #0066cc;
            --custom-secondary: #6c757d;
            --custom-success: #198754;
            --custom-danger: #dc3545;
        }

        body {
            background-color: #f8f9fa;
        }

        .sidebar {
            background-color: white;
            border-right: 1px solid #dee2e6;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            width: 280px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .logo {
            color: var(--custom-primary);
            border-bottom: 1px solid #dee2e6;
            padding: 1rem;
            text-align: center;
        }

        .logo h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .logo .subtitle {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        .nav-section-header {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #6c757d;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            margin-top: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            color: #212529;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            border-bottom: 1px solid #f8f9fa;
            position: relative;
        }

        .nav-item:hover {
            background-color: #f8f9fa;
            color: var(--custom-primary);
            text-decoration: none;
        }

        .nav-item.active {
            background-color: var(--custom-primary);
            color: white;
            border-left-color: #0052a3;
        }

        .nav-item.offline {
            opacity: 0.6;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-left: auto;
        }

        .status-dot.online {
            background-color: var(--custom-success);
        }

        .status-dot.offline {
            background-color: var(--custom-danger);
        }

        .main-content {
            background-color: white;
            min-height: 100vh;
            flex: 1;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 1rem;
        }

        .page-title {
            margin: 0;
            font-size: 2rem;
            font-weight: 600;
            color: #212529;
        }

        .page-subtitle {
            margin: 0.5rem 0 0 0;
            color: #6c757d;
            font-size: 1.125rem;
        }

        .app-container {
            display: flex;
        }

        /* Alert Styles */
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.375rem;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            color: #0f5132;
            background-color: #d1e7dd;
            border-color: #badbcc;
        }

        .alert-error {
            color: #842029;
            background-color: #f8d7da;
            border-color: #f5c2c7;
        }

        /* Card Styles */
        .card {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .card-header {
            padding: 1rem 1.5rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-radius: 0.375rem 0.375rem 0 0;
        }

        .card-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #212529;
        }

        .card-subtitle {
            margin: 0.25rem 0 0 0;
            color: #6c757d;
            font-size: 0.875rem;
        }

        .card-content {
            padding: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #212529;
        }

        .form-input {
            display: block;
            width: 100%;
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #212529;
            background-color: white;
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-input:focus {
            color: #212529;
            background-color: white;
            border-color: #86b7fe;
            outline: 0;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .helper-text {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #6c757d;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            margin-bottom: 0;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            text-align: center;
            text-decoration: none;
            vertical-align: middle;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 0.375rem;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .btn:hover {
            text-decoration: none;
        }

        .btn-primary {
            color: white;
            background-color: var(--custom-primary);
            border-color: var(--custom-primary);
        }

        .btn-primary:hover {
            color: white;
            background-color: #0052a3;
            border-color: #004785;
        }

        .btn-secondary {
            color: white;
            background-color: var(--custom-secondary);
            border-color: var(--custom-secondary);
        }

        .btn-secondary:hover {
            color: white;
            background-color: #565e64;
            border-color: #4c5258;
        }

        .btn-error {
            color: white;
            background-color: var(--custom-danger);
            border-color: var(--custom-danger);
        }

        .btn-error:hover {
            color: white;
            background-color: #bb2d3b;
            border-color: #b02a37;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Response Styles */
        .response-container {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }

        .response-title {
            font-weight: 600;
            color: #212529;
            margin-bottom: 0.5rem;
        }

        .response-content {
            background-color: white;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Validation Styles */
        .validation-message {
            margin-top: 0.25rem;
            font-size: 0.875rem;
        }

        .validation-success {
            color: var(--custom-success);
        }

        .validation-error {
            color: var(--custom-danger);
        }

        .json-valid {
            border-color: var(--custom-success);
        }

        .json-invalid {
            border-color: var(--custom-danger);
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Analytics Table Styles (for caching service) */
        .analytics-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .analytics-info {
            color: #6c757d;
            font-size: 0.875rem;
        }

        .analytics-refresh {
            background-color: var(--custom-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .analytics-refresh:hover {
            background-color: #0052a3;
        }

        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .analytics-table th,
        .analytics-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .analytics-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .sortable {
            cursor: pointer;
            user-select: none;
        }

        .sortable:hover {
            background-color: #e9ecef;
        }

        .sort-asc::after {
            content: " ↑";
        }

        .sort-desc::after {
            content: " ↓";
        }

        .no-data {
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }

        .key-cell {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.875rem;
        }

        .hits-cell {
            font-weight: 600;
            color: var(--custom-primary);
        }

        .date-cell {
            color: #6c757d;
            font-size: 0.875rem;
        }

        /* AI Service specific styles */
        .prompt-container {
            margin-bottom: 2rem;
        }
        
        .prompt-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }
        
        .provider-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .provider-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
        }
        
        .provider-option:hover {
            border-color: #0366d6;
            background-color: #f6f8fa;
        }
        
        .provider-option.selected {
            border-color: #0366d6;
            background-color: #e3f2fd;
        }
        
        .provider-option input[type="radio"] {
            margin: 0;
        }
        
        .provider-status {
            font-size: 0.8em;
            margin-left: auto;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 0.5rem;
        }
        
        .status-online {
            background-color: #28a745;
        }
        
        .status-offline {
            background-color: #dc3545;
        }
        
        .status-unknown {
            background-color: #ffc107;
        }
        
        .ai-response {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
            white-space: pre-wrap;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
        }
        
        .usage-info {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9em;
        }
        
        .usage-info h4 {
            margin: 0 0 0.5rem 0;
            color: #1976d2;
        }
        
        .usage-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .advanced-options {
            margin: 1rem 0;
        }
        
        .advanced-toggle {
            cursor: pointer;
            color: #0366d6;
            font-size: 0.9em;
            margin-bottom: 0.5rem;
        }
        
        .advanced-content {
            display: none;
            background-color: #f6f8fa;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 0.5rem;
        }
        
        .advanced-content.show {
            display: block;
        }
        
        .option-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .loading-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-style: italic;
        }
        
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0366d6;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .example-prompts {
            margin-bottom: 1rem;
        }

        .example-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .example-btn {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .example-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        /* Swagger UI Integration Styles */
        #swagger-ui {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        #swagger-ui .swagger-ui {
            max-width: none;
        }

        #swagger-ui .topbar {
            display: none;
        }

        #swagger-ui .info {
            margin: 20px 0;
        }

        #swagger-ui .info .title {
            font-size: 1.5rem;
            color: var(--custom-primary);
        }

        #swagger-ui .scheme-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        #swagger-ui .opblock-tag {
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1rem;
        }

        #swagger-ui .opblock {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        #swagger-ui .opblock.is-open .opblock-summary {
            border-bottom: 1px solid #dee2e6;
        }

        #swagger-ui .opblock .opblock-summary-method {
            border-radius: 0.375rem;
            font-weight: 600;
        }

        #swagger-ui .opblock.opblock-post .opblock-summary-method {
            background: var(--custom-success);
        }

        #swagger-ui .opblock.opblock-get .opblock-summary-method {
            background: var(--custom-primary);
        }

        #swagger-ui .opblock.opblock-delete .opblock-summary-method {
            background: var(--custom-danger);
        }

        #swagger-ui .opblock.opblock-put .opblock-summary-method {
            background: #fd7e14;
        }

        #swagger-ui .btn {
            border-radius: 0.375rem;
            font-weight: 500;
            padding: 0.375rem 0.75rem;
            transition: all 0.2s ease;
        }

        #swagger-ui .btn.execute {
            background: var(--custom-primary);
            border-color: var(--custom-primary);
        }

        #swagger-ui .btn.execute:hover {
            background: #0052a3;
            border-color: #004785;
        }

        #swagger-ui .btn.btn-clear {
            background: var(--custom-secondary);
            border-color: var(--custom-secondary);
            color: white;
        }

        #swagger-ui .btn.btn-clear:hover {
            background: #565e64;
            border-color: #4c5258;
        }

        #swagger-ui .parameters-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
        }

        #swagger-ui .parameter__name {
            color: var(--custom-primary);
            font-weight: 600;
        }

        #swagger-ui input[type="text"],
        #swagger-ui textarea,
        #swagger-ui select {
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        #swagger-ui input[type="text"]:focus,
        #swagger-ui textarea:focus,
        #swagger-ui select:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            outline: 0;
        }

        #swagger-ui .response-col_status {
            font-weight: 600;
        }

        #swagger-ui .response-col_status.response-undocumented {
            color: var(--custom-secondary);
        }

        #swagger-ui .response .response-col_status {
            color: var(--custom-success);
        }

        #swagger-ui .responses-inner h4 {
            color: var(--custom-primary);
            font-weight: 600;
        }

        #swagger-ui .highlight-code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }

        #swagger-ui .model-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }

        #swagger-ui .model .property {
            color: var(--custom-primary);
        }

        #swagger-ui .prop-type {
            color: var(--custom-secondary);
        }

        /* Ensure proper responsiveness */
        #swagger-ui .wrapper {
            max-width: 100%;
            overflow-x: auto;
        }

        #swagger-ui .swagger-ui table {
            table-layout: auto;
            width: 100%;
        }

        /* Fix potential z-index issues */
        #swagger-ui .dialog-ux {
            z-index: 1050;
        }

        #swagger-ui .model-box-control:focus {
            outline: 2px solid var(--custom-primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar" id="navigation-sidebar">
            <!-- Navigation will be loaded here by navigation.js -->
        </nav>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">AI Service</h1>
                <p class="page-subtitle">Interact with Claude, OpenAI, and Ollama language models</p>
            </div>

            <div class="alert alert-success" id="successAlert">
                <strong>Success!</strong> <span id="successMessage"></span>
            </div>

            <div class="alert alert-error" id="errorAlert">
                <strong>Error!</strong> <span id="errorMessage"></span>
            </div>

            <!-- AI Prompt Interface -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">AI Prompt Interface</h2>
                    <p class="card-subtitle">Send prompts to AI models and receive responses</p>
                </div>
                <div class="card-content">
                    <!-- Provider Selection -->
                    <div class="form-group">
                        <label class="form-label">Select AI Provider</label>
                        <div class="provider-selector">
                            <div class="provider-option selected" data-provider="claude">
                                <input type="radio" name="provider" value="claude" checked>
                                <span>Claude</span>
                                <div class="provider-status">
                                    <span class="status-indicator status-unknown"></span>
                                </div>
                            </div>
                            <div class="provider-option" data-provider="chatgpt">
                                <input type="radio" name="provider" value="chatgpt">
                                <span>ChatGPT</span>
                                <div class="provider-status">
                                    <span class="status-indicator status-unknown"></span>
                                </div>
                            </div>
                            <div class="provider-option" data-provider="ollama">
                                <input type="radio" name="provider" value="ollama">
                                <span>Ollama</span>
                                <div class="provider-status">
                                    <span class="status-indicator status-unknown"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Example Prompts -->
                    <div class="form-group example-prompts">
                        <label class="form-label">Example Prompts</label>
                        <div class="example-buttons">
                            <button class="example-btn" data-prompt="Explain quantum computing in simple terms">Quantum Computing</button>
                            <button class="example-btn" data-prompt="Write a short story about a robot learning to paint">Creative Story</button>
                            <button class="example-btn" data-prompt="Generate a Python function to calculate fibonacci numbers">Code Generation</button>
                            <button class="example-btn" data-prompt="What are the main differences between REST and GraphQL APIs?">Technical Q&A</button>
                            <button class="example-btn" data-prompt="Translate 'Hello, how are you?' to French, Spanish, and German">Translation</button>
                        </div>
                    </div>

                    <!-- Prompt Form -->
                    <form id="promptForm">
                        <div class="form-group">
                            <label class="form-label" for="promptText">Your Prompt</label>
                            <textarea 
                                id="promptText" 
                                class="prompt-textarea" 
                                placeholder="Enter your prompt here... (e.g., 'Explain machine learning in simple terms' or 'Write a Python function to sort a list')"
                                required
                            ></textarea>
                        </div>

                        <!-- Advanced Options -->
                        <div class="advanced-options">
                            <div class="advanced-toggle" onclick="toggleAdvanced()">
                                <i class="bi bi-gear-fill"></i> Advanced Options
                            </div>
                            <div class="advanced-content" id="advancedContent">
                                <div class="option-group">
                                    <div class="form-group">
                                        <label class="form-label" for="maxTokens">Max Tokens</label>
                                        <input type="number" id="maxTokens" class="form-input" value="1000" min="1" max="4000">
                                        <div class="helper-text">Maximum tokens in response (1-4000)</div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="temperature">Temperature</label>
                                        <input type="range" id="temperature" class="form-input" value="0.7" min="0" max="1" step="0.1">
                                        <div class="helper-text">Creativity level: <span id="temperatureValue">0.7</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                Send Prompt
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearPrompt()">
                                Clear
                            </button>
                            <div class="loading-indicator" id="loadingIndicator">
                                <div class="spinner"></div>
                                <span>Processing...</span>
                            </div>
                        </div>
                    </form>

                    <!-- AI Response -->
                    <div id="responseContainer" style="display: none;">
                        <h3>AI Response</h3>
                        <div id="aiResponse" class="ai-response"></div>
                        
                        <!-- Usage Information -->
                        <div id="usageInfo" class="usage-info" style="display: none;">
                            <h4>Usage Information</h4>
                            <div class="usage-metrics">
                                <div class="metric">
                                    <span>Prompt Tokens:</span>
                                    <span id="promptTokens">0</span>
                                </div>
                                <div class="metric">
                                    <span>Response Tokens:</span>
                                    <span id="responseTokens">0</span>
                                </div>
                                <div class="metric">
                                    <span>Total Tokens:</span>
                                    <span id="totalTokens">0</span>
                                </div>
                                <div class="metric">
                                    <span>Estimated Cost:</span>
                                    <span id="estimatedCost">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Service Status -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Service Status</h2>
                    <p class="card-subtitle">Monitor AI service health and availability</p>
                </div>
                <div class="card-content">
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="checkStatus()">Check Status</button>
                        <button type="button" class="btn btn-secondary" onclick="checkModels()">List Models</button>
                        <button type="button" class="btn btn-secondary" onclick="checkHealth()">Health Check</button>
                    </div>
                    <div id="statusResponse" class="response-container" style="display: none;">
                        <div class="response-title">Status Information:</div>
                        <div id="statusResponseContent" class="response-content"></div>
                    </div>
                </div>
            </div>

            <!-- Usage Analytics -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Usage Analytics</h2>
                    <p class="card-subtitle">View AI service usage statistics and token consumption</p>
                </div>
                <div class="card-content">
                    <div class="analytics-controls">
                        <div class="analytics-info">
                            <span id="analyticsCount">Loading...</span> requests tracked
                        </div>
                        <button class="analytics-refresh" onclick="loadAnalytics()">
                            Refresh Data
                        </button>
                    </div>
                    <div id="analyticsData" class="response-container" style="display: none;">
                        <div class="response-content" id="analyticsContent"></div>
                    </div>
                </div>
            </div>

            <!-- API Documentation -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">API Documentation</h2>
                    <p class="card-subtitle">Interactive API documentation for AI service</p>
                </div>
                <div class="card-content">
                    <div id="swagger-ui"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/swagger-ui-dist@5.10.5/swagger-ui-bundle.js"></script>
    <script src="/services/js/navigation.js"></script>
    <script>
        NooblyNavigation.renderNavigation('navigation-sidebar', 'ai');
    </script>
    <script>
        // Global state
        let selectedProvider = 'claude';
        let isProcessing = false;

        // Utility functions
        function showAlert(message, type = 'success') {
            const alertElement = document.getElementById(type + 'Alert');
            const messageElement = document.getElementById(type + 'Message');
            messageElement.textContent = message;
            alertElement.classList.add('show');
            setTimeout(() => alertElement.classList.remove('show'), 5000);
        }

        function showResponse(containerId, contentId, data) {
            const container = document.getElementById(containerId);
            const content = document.getElementById(contentId);
            content.textContent = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
            container.style.display = 'block';
        }

        function setLoading(isLoading) {
            isProcessing = isLoading;
            const submitBtn = document.getElementById('submitBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            if (isLoading) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Processing...';
                loadingIndicator.style.display = 'flex';
            } else {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Prompt';
                loadingIndicator.style.display = 'none';
            }
        }

        async function makeRequest(url, method = 'GET', body = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }
            
            const response = await fetch(url, options);
            const contentType = response.headers.get('content-type');
            
            if (contentType && contentType.includes('application/json')) {
                return await response.json();
            } else {
                return await response.text();
            }
        }

        // Provider selection
        document.querySelectorAll('.provider-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.provider-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                selectedProvider = option.dataset.provider;
                option.querySelector('input').checked = true;
                checkProviderStatus(selectedProvider);
            });
        });

        // Example prompt buttons
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('promptText').value = btn.dataset.prompt;
            });
        });

        // Advanced options toggle
        function toggleAdvanced() {
            const content = document.getElementById('advancedContent');
            content.classList.toggle('show');
        }

        // Temperature slider update
        document.getElementById('temperature').addEventListener('input', (e) => {
            document.getElementById('temperatureValue').textContent = e.target.value;
        });

        // Clear prompt
        function clearPrompt() {
            document.getElementById('promptText').value = '';
            document.getElementById('responseContainer').style.display = 'none';
        }

        // Check provider status
        async function checkProviderStatus(provider) {
            try {
                const result = await makeRequest('/services/ai/api/health');
                const indicator = document.querySelector(`[data-provider="${provider}"] .status-indicator`);
                
                if (result.healthy) {
                    indicator.className = 'status-indicator status-online';
                } else {
                    indicator.className = 'status-indicator status-offline';
                }
            } catch (error) {
                const indicator = document.querySelector(`[data-provider="${provider}"] .status-indicator`);
                indicator.className = 'status-indicator status-offline';
            }
        }

        // Main prompt form handler
        document.getElementById('promptForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (isProcessing) return;
            
            const prompt = document.getElementById('promptText').value.trim();
            const maxTokens = parseInt(document.getElementById('maxTokens').value);
            const temperature = parseFloat(document.getElementById('temperature').value);
            
            if (!prompt) {
                showAlert('Please enter a prompt', 'error');
                return;
            }
            
            try {
                setLoading(true);
                
                const requestBody = {
                    prompt: prompt,
                    options: {
                        maxTokens: maxTokens,
                        temperature: temperature
                    }
                };
                
                const result = await makeRequest('/services/ai/api/prompt', 'POST', requestBody);
                
                // Show response
                document.getElementById('responseContainer').style.display = 'block';
                document.getElementById('aiResponse').textContent = result.content;
                
                // Show usage info if available
                if (result.usage) {
                    document.getElementById('usageInfo').style.display = 'block';
                    document.getElementById('promptTokens').textContent = result.usage.promptTokens || 0;
                    document.getElementById('responseTokens').textContent = result.usage.completionTokens || 0;
                    document.getElementById('totalTokens').textContent = result.usage.totalTokens || 0;
                    
                    // Calculate estimated cost (basic estimation)
                    const cost = calculateCost(result.usage, result.provider);
                    document.getElementById('estimatedCost').textContent = '$' + cost.toFixed(6);
                }
                
                showAlert(`Response received from ${result.provider || selectedProvider}`);
                loadAnalytics(); // Refresh analytics
                
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
                console.error('Prompt error:', error);
            } finally {
                setLoading(false);
            }
        });

        // Cost calculation
        function calculateCost(usage, provider) {
            const rates = {
                claude: { input: 0.000003, output: 0.000015 },
                chatgpt: { input: 0.0000005, output: 0.0000015 },
                ollama: { input: 0, output: 0 }
            };
            
            const rate = rates[provider] || rates.ollama;
            return (usage.promptTokens * rate.input) + (usage.completionTokens * rate.output);
        }

        // Service status functions
        async function checkStatus() {
            try {
                const result = await makeRequest('/services/ai/api/status');
                showResponse('statusResponse', 'statusResponseContent', result);
                showAlert('Status checked successfully');
            } catch (error) {
                showAlert('Error checking status: ' + error.message, 'error');
                showResponse('statusResponse', 'statusResponseContent', 'Error: ' + error.message);
            }
        }

        async function checkModels() {
            try {
                const result = await makeRequest('/services/ai/api/models');
                showResponse('statusResponse', 'statusResponseContent', result);
                showAlert('Models retrieved successfully');
            } catch (error) {
                showAlert('Error retrieving models: ' + error.message, 'error');
                showResponse('statusResponse', 'statusResponseContent', 'Error: ' + error.message);
            }
        }

        async function checkHealth() {
            try {
                const result = await makeRequest('/services/ai/api/health');
                showResponse('statusResponse', 'statusResponseContent', result);
                showAlert('Health check completed');
            } catch (error) {
                showAlert('Error during health check: ' + error.message, 'error');
                showResponse('statusResponse', 'statusResponseContent', 'Error: ' + error.message);
            }
        }

        // Analytics
        async function loadAnalytics() {
            try {
                const result = await makeRequest('/services/ai/api/analytics');
                document.getElementById('analyticsData').style.display = 'block';
                document.getElementById('analyticsContent').textContent = JSON.stringify(result, null, 2);
                
                if (result.totalSessions !== undefined) {
                    document.getElementById('analyticsCount').textContent = result.totalSessions;
                }
                
            } catch (error) {
                showAlert('Error loading analytics: ' + error.message, 'error');
                document.getElementById('analyticsCount').textContent = 'Error';
            }
        }

        // Check AI service status and enable/disable UI accordingly
        async function checkServiceStatus() {
            try {
                const result = await makeRequest('/services/ai/api/status');
                const submitBtn = document.getElementById('submitBtn');
                const promptTextarea = document.getElementById('prompt');

                if (result.enabled === false || !result.hasApiKey) {
                    // Disable the submit button and show warning
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'API Key Required';
                    submitBtn.className = 'btn btn-secondary';

                    // Show warning message
                    const warningDiv = document.createElement('div');
                    warningDiv.className = 'alert alert-warning mt-3';
                    warningDiv.innerHTML = `
                        <strong><i class="bi bi-exclamation-triangle-fill"></i> AI Service Disabled</strong><br>
                        No API key is configured for this AI provider.
                        Please configure an API key in your environment variables to enable AI functionality.
                        <br><small>Status: ${result.status}</small>
                    `;

                    // Insert warning after the submit button group
                    const btnGroup = document.querySelector('.btn-group');
                    btnGroup.parentNode.insertBefore(warningDiv, btnGroup.nextSibling);

                    // Optionally disable the textarea too
                    if (promptTextarea) {
                        promptTextarea.placeholder = 'AI service disabled - API key required';
                    }
                } else {
                    // Service is enabled
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Send Prompt';
                    submitBtn.className = 'btn btn-primary';

                    if (promptTextarea) {
                        promptTextarea.placeholder = 'Enter your prompt here...';
                    }
                }
            } catch (error) {
                console.error('Error checking service status:', error);
                // If we can't check status, assume it's disabled for safety
                const submitBtn = document.getElementById('submitBtn');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Service Unavailable';
                    submitBtn.className = 'btn btn-secondary';
                }
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkStatus();
            // Check service status first
            checkStatus();
            checkServiceStatus();
            checkStatus();

            checkStatus();
            // Check status of all providers
            checkStatus();
            ['claude', 'chatgpt', 'ollama'].forEach(checkProviderStatus);
            checkStatus();

            checkStatus();
            // Load initial analytics
            checkStatus();
            loadAnalytics();
            checkStatus();

            checkStatus();
            // Auto-refresh analytics every 30 seconds
            checkStatus();
            setInterval(loadAnalytics, 30000);
            checkStatus();
        });
            checkStatus();

            checkStatus();
        // Swagger UI setup
            checkStatus();
        const spec = {
            checkStatus();
            openapi: '3.0.0',
            checkStatus();
            info: {
            checkStatus();
                title: 'AI Service API',
            checkStatus();
                description: 'REST API for AI service operations with multiple provider support',
            checkStatus();
                version: '1.0.0'
            checkStatus();
            },
            checkStatus();
            servers: [
            checkStatus();
                { url: '/services/ai/api', description: 'AI Service API' }
            checkStatus();
            ],
            checkStatus();
            paths: {
            checkStatus();
                '/prompt': {
            checkStatus();
                    post: {
            checkStatus();
                        summary: 'Send prompt to AI',
            checkStatus();
                        description: 'Send a prompt to the configured AI provider and get a response',
            checkStatus();
                        requestBody: {
            checkStatus();
                            required: true,
            checkStatus();
                            content: {
            checkStatus();
                                'application/json': {
            checkStatus();
                                    schema: {
            checkStatus();
                                        type: 'object',
            checkStatus();
                                        properties: {
            checkStatus();
                                            prompt: { type: 'string', example: 'Explain quantum computing' },
            checkStatus();
                                            options: {
            checkStatus();
                                                type: 'object',
            checkStatus();
                                                properties: {
            checkStatus();
                                                    maxTokens: { type: 'integer', example: 1000 },
            checkStatus();
                                                    temperature: { type: 'number', example: 0.7 }
            checkStatus();
                                                }
            checkStatus();
                                            }
            checkStatus();
                                        },
            checkStatus();
                                        required: ['prompt']
            checkStatus();
                                    }
            checkStatus();
                                }
            checkStatus();
                            }
            checkStatus();
                        },
            checkStatus();
                        responses: {
            checkStatus();
                            '200': {
            checkStatus();
                                description: 'AI response received',
            checkStatus();
                                content: {
            checkStatus();
                                    'application/json': {
            checkStatus();
                                        schema: {
            checkStatus();
                                            type: 'object',
            checkStatus();
                                            properties: {
            checkStatus();
                                                content: { type: 'string' },
            checkStatus();
                                                usage: {
            checkStatus();
                                                    type: 'object',
            checkStatus();
                                                    properties: {
            checkStatus();
                                                        promptTokens: { type: 'integer' },
            checkStatus();
                                                        completionTokens: { type: 'integer' },
            checkStatus();
                                                        totalTokens: { type: 'integer' }
            checkStatus();
                                                    }
            checkStatus();
                                                },
            checkStatus();
                                                model: { type: 'string' },
            checkStatus();
                                                provider: { type: 'string' }
            checkStatus();
                                            }
            checkStatus();
                                        }
            checkStatus();
                                    }
            checkStatus();
                                }
            checkStatus();
                            }
            checkStatus();
                        }
            checkStatus();
                    }
            checkStatus();
                },
            checkStatus();
                '/status': {
            checkStatus();
                    get: {
            checkStatus();
                        summary: 'Service status',
            checkStatus();
                        description: 'Check if the AI service is running',
            checkStatus();
                        responses: {
            checkStatus();
                            '200': {
            checkStatus();
                                description: 'Service status',
            checkStatus();
                                content: {
            checkStatus();
                                    'application/json': {
            checkStatus();
                                        schema: { type: 'object' }
            checkStatus();
                                    }
            checkStatus();
                                }
            checkStatus();
                            }
            checkStatus();
                        }
            checkStatus();
                    }
            checkStatus();
                },
            checkStatus();
                '/analytics': {
            checkStatus();
                    get: {
            checkStatus();
                        summary: 'Usage analytics',
            checkStatus();
                        description: 'Get AI service usage statistics',
            checkStatus();
                        responses: {
            checkStatus();
                            '200': {
            checkStatus();
                                description: 'Analytics data',
            checkStatus();
                                content: {
            checkStatus();
                                    'application/json': {
            checkStatus();
                                        schema: { type: 'object' }
            checkStatus();
                                    }
            checkStatus();
                                }
            checkStatus();
                            }
            checkStatus();
                        }
            checkStatus();
                    }
            checkStatus();
                },
            checkStatus();
                '/models': {
            checkStatus();
                    get: {
            checkStatus();
                        summary: 'Available models',
            checkStatus();
                        description: 'List available models (Ollama provider)',
            checkStatus();
                        responses: {
            checkStatus();
                            '200': {
            checkStatus();
                                description: 'List of models',
            checkStatus();
                                content: {
            checkStatus();
                                    'application/json': {
            checkStatus();
                                        schema: { type: 'object' }
            checkStatus();
                                    }
            checkStatus();
                                }
            checkStatus();
                            }
            checkStatus();
                        }
            checkStatus();
                    }
            checkStatus();
                },
            checkStatus();
                '/health': {
            checkStatus();
                    get: {
            checkStatus();
                        summary: 'Health check',
            checkStatus();
                        description: 'Check provider health status',
            checkStatus();
                        responses: {
            checkStatus();
                            '200': {
            checkStatus();
                                description: 'Health status',
            checkStatus();
                                content: {
            checkStatus();
                                    'application/json': {
            checkStatus();
                                        schema: {
            checkStatus();
                                            type: 'object',
            checkStatus();
                                            properties: {
            checkStatus();
                                                healthy: { type: 'boolean' },
            checkStatus();
                                                provider: { type: 'string' }
            checkStatus();
                                            }
            checkStatus();
                                        }
            checkStatus();
                                    }
            checkStatus();
                                }
            checkStatus();
                            }
            checkStatus();
                        }
            checkStatus();
                    }
            checkStatus();
                }
            checkStatus();
            }
            checkStatus();
        };
            checkStatus();

            checkStatus();
        // Initialize Swagger UI - Proper embedded implementation
            checkStatus();
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
            // Ensure Swagger UI dependencies are loaded
            if (typeof SwaggerUIBundle === 'undefined') {
                console.error('SwaggerUIBundle not loaded');
                document.getElementById('swagger-ui').innerHTML = '<div style="color: red; padding: 20px; text-align: center;">Swagger UI failed to load. Please check your internet connection and refresh the page.</div>';
                return;
            }

            try {
                // Clear any existing content
                const container = document.getElementById('swagger-ui');
                container.innerHTML = '';

                const ui = SwaggerUIBundle({
                    spec: spec,
                    dom_id: '#swagger-ui',
                    deepLinking: false,
                    presets: [
                        SwaggerUIBundle.presets.apis
                    ],
                    plugins: [
                        SwaggerUIBundle.plugins.DownloadUrl
                    ],
                    layout: "BaseLayout",
                    validatorUrl: null,
                    tryItOutEnabled: true,
                    displayOperationId: false,
                    showExtensions: false,
                    showCommonExtensions: false,
                    docExpansion: 'list',
                    defaultModelsExpandDepth: 1,
                    defaultModelExpandDepth: 1,
                    filter: false,
                    showRequestHeaders: false,
                    supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'],
                    onComplete: function() {
                        console.log('Swagger UI initialized successfully');

                        // Remove top bar if it exists
                        const topbar = document.querySelector('#swagger-ui .topbar');
                        if (topbar) {
                            topbar.style.display = 'none';
                        }

                        // Ensure proper styling
                        const swaggerContainer = document.querySelector('#swagger-ui');
                        if (swaggerContainer) {
                            swaggerContainer.style.fontFamily = 'inherit';
                        }
                    },
                    onFailure: function(error) {
                        console.error('Swagger UI initialization failed:', error);
                        document.getElementById('swagger-ui').innerHTML = '<div style="color: red; padding: 20px;">Failed to initialize API documentation: ' + error.message + '</div>';
                    }
                });

                // Store reference globally for debugging
                window.swaggerUI = ui;

                // Backup initialization check
                setTimeout(function() {
                    const swaggerContent = document.querySelector('#swagger-ui .swagger-ui');
                    if (!swaggerContent) {
                        console.warn('Swagger UI may not have initialized properly');
                        document.getElementById('swagger-ui').innerHTML = '<div style="color: orange; padding: 20px;">API documentation is loading... If this message persists, please refresh the page.</div>';
                    }
                }, 3000);

            } catch (error) {
                console.error('Critical error initializing Swagger UI:', error);
                document.getElementById('swagger-ui').innerHTML = '<div style="color: red; padding: 20px; border: 1px solid red; border-radius: 4px;"><strong>Error loading API documentation</strong><br>Error: ' + error.message + '<br><button onclick="location.reload()" style="margin-top: 10px; padding: 5px 10px;">Reload Page</button></div>';
            }
        });
    </script>
</body>
</html>